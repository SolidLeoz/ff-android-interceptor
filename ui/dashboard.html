<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Mobile Interceptor (PT)</title>
  <link rel="stylesheet" href="dashboard.css" />
</head>
<body>
  <header class="topbar" id="topbar">
    <div>
      <div class="title">Mobile Interceptor</div>
      <div class="subtitle">Intercept + Repeater (Firefox Android)</div>
    </div>

    <div class="mode-switch">
      <select id="interceptMode">
        <option value="OFF">OFF</option>
        <option value="OBSERVE">OBSERVE</option>
        <option value="INTERCEPT">INTERCEPT</option>
      </select>
      <span id="armedBadge" class="armed-badge hidden"></span>
    </div>
  </header>

  <main class="wrap">
<section class="disclaimer hidden" id="disclaimer">
  <strong>Authorized Use Only</strong> — This tool is intended exclusively for personal lab environments, educational purposes, and authorized penetration testing. Do not intercept, modify, or replay traffic on systems you do not own or have explicit written permission to test. Unauthorized interception of network traffic may violate applicable laws.
  <button id="btnDismissDisclaimer" class="ghost btn-sm" style="margin-left:8px">Dismiss</button>
</section>

<section class="card">
  <div class="cardHead">
    <h2>Scope</h2>
    <div class="muted">Intercept target only</div>
  </div>

  <div class="grid">
    <label>
      <span>Scope mode</span>
      <select id="scopeMode">
        <option value="ALLOWLIST">ALLOWLIST (recommended)</option>
        <option value="OFF">OFF (intercept all)</option>
      </select>
    </label>

    <label>
      <span>Bypass static assets</span>
      <select id="bypassStatic">
        <option value="true">ON</option>
        <option value="false">OFF</option>
      </select>
    </label>

    <label class="col2">
      <span>Allow domains (one per line: example.com or *.example.com)</span>
      <textarea id="allowDomains" rows="4" spellcheck="false"></textarea>
    </label>

    <label class="col2">
      <span>Allow URL contains (one per line: /api/ , /graphql , etc.)</span>
      <textarea id="allowUrlContains" rows="3" spellcheck="false"></textarea>
    </label>

    <div class="actions col2">
      <button id="btnLoadPolicy" class="ghost">Load</button>
      <button id="btnSavePolicy" class="primary">Save</button>
      <button id="btnPanicOff" class="danger">PANIC: Intercept OFF</button>
    </div>
  </div>
</section>


    <section class="card">
      <div class="cardHead">
        <h2>Queue</h2>
        <div style="display:flex;gap:8px;align-items:center">
          <div class="pill" id="queueSize">0</div>
          <button id="btnForwardAll" class="primary btn-sm" disabled>Forward All</button>
          <button id="btnDropAll" class="danger btn-sm" disabled>Drop All</button>
        </div>
      </div>
      <input id="queueSearch" type="text" placeholder="Filter queue..." style="margin-bottom:8px" />
      <div id="queueList" class="list"></div>
    </section>

    <section class="card">
      <div class="cardHead">
        <h2>Editor</h2>
        <div class="muted" id="editorHint">Select a request from the Queue.</div>
      </div>

      <div class="grid">
        <label>
          <span>Method</span>
          <input id="reqMethod" type="text" placeholder="GET/POST/PUT..." />
        </label>

        <label class="col2">
          <span>URL</span>
          <input id="reqUrl" type="text" placeholder="https://target/..." />
        </label>

        <label class="col2">
          <span>Headers (JSON: {"name":"value"})</span>
          <textarea id="reqHeaders" rows="6" spellcheck="false"></textarea>
        </label>

        <label class="col2">
          <span>Body (text) or Base64 raw</span>
          <textarea id="reqBody" rows="8" spellcheck="false"></textarea>
        </label>

        <div class="actions col2">
          <button id="btnForward" class="primary" disabled>Forward</button>
          <button id="btnDrop" class="danger" disabled>Drop</button>
          <button id="btnSaveRepeater" class="ghost" disabled>Send to Repeater</button>
        </div>
      </div>
      <div class="muted" id="editorReadonlyHint" style="display:none;margin-top:6px;font-size:12px">
        Method and body are read-only in intercept mode. Use Repeater for full editing.
      </div>

      <details class="note">
        <summary>Important limitations</summary>
        <ul>
          <li>The request is <b>held</b> (not cancelled); "Forward" releases it to the server.</li>
          <li><b>URL and headers</b> are editable. Method and body are <b>read-only</b> — use Repeater for full editing.</li>
          <li>The page receives the real server response after Forward.</li>
        </ul>
      </details>
    </section>

    <section class="card">
      <div class="cardHead">
        <h2>Repeater</h2>
        <div style="display:flex;gap:8px">
          <button id="btnExportRepeater" class="ghost btn-sm">Export</button>
          <label class="ghost btn-sm" style="cursor:pointer;display:inline-flex;align-items:center;border:1px solid var(--border);border-radius:14px;padding:6px 10px;font-size:12px;font-weight:800">Import<input id="btnImportRepeater" type="file" accept=".json" style="display:none" /></label>
          <button id="btnRefreshRepeater" class="ghost btn-sm">Refresh</button>
        </div>
      </div>

      <div id="repeaterList" class="list"></div>

      <div class="cardSub">
        <h3>Response</h3>
        <div style="display:flex;gap:8px;margin-bottom:6px;align-items:center;flex-wrap:wrap">
          <input id="noteMemo" type="text" placeholder="Memo (optional)" style="width:160px;padding:6px 10px;font-size:12px" />
          <button id="btnSaveNote" class="ghost btn-sm" disabled>Save to Notes</button>
          <label class="toggle toggle-sm">
            <input id="toggleSensitive" type="checkbox" />
            <span>Show sensitive</span>
          </label>
        </div>
        <pre id="responseBox" class="pre"></pre>
      </div>
    </section>

    <section class="card">
      <div class="cardHead">
        <h2>Notes</h2>
        <div style="display:flex;gap:8px">
          <button id="btnExportNotes" class="ghost btn-sm">Export</button>
          <button id="btnClearNotes" class="danger btn-sm">Clear all</button>
        </div>
      </div>
      <div id="notesList" class="list"></div>
    </section>

    <section class="card">
      <div class="cardHead">
        <h2>Audit Log</h2>
        <div style="display:flex;gap:8px">
          <button id="btnRefreshAudit" class="ghost btn-sm">Refresh</button>
          <button id="btnClearAudit" class="danger btn-sm">Clear</button>
        </div>
      </div>
      <div id="auditList" class="list"></div>
    </section>

    <div id="ctxMenu" class="ctx-menu hidden">
      <div id="ctxAddScope" class="ctx-item">Add domain to scope</div>
    </div>
  </main>

  <script src="../lib/redact.js"></script>
  <script src="../lib/utils.js"></script>
  <script src="dashboard.js"></script>
</body>
</html>
